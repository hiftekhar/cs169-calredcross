<%= render 'navbar' %>

<div class="home-container">
    <div class="carousel-container">
        <div id="owl-demo" class="home-carousel">
            <% @images.each do |image| %>
                <div class="item crop-height">
                    <div class='photo-screen'></div>
                    <div class='photo-text'>
                        <%= image.text %>
                    </div>
                    <%= image_tag(image.url, :class => "carousel-image") %>
                </div>
            <%end %>
        </div>
    </div>
    
    <div class="home-bottom-section">
        <div class="home-left-section">
            <div class="bulletin-container">
                 <% if current_user and current_user.isOfficer %>
                    <div class="edit-bulletin" id="edit-container">
                        <img src="images/white_edit.png" id="top-edit">
                    </div>
                    <div id="edit-help">
                        Click here to toggle edit content. Editable text will turn red, uneditable text will turn black.
                        <div id="edit-help-carrot"></div>
                    </div>
                <%end%>
                <div class="section-header">
                    <img class="symbol" id="bulletin-symbol" src="/images/bulletin_icon.png"><div class="section-title">BULLETIN</div>
                </div>
                <div class="bulletin-description">
                    <%= @info.bulletin %>
                </div>
            </div>
            <div class="upcoming-events-container">
                <div class="section-header">
                    <img class="symbol" id="events-symbol" src="/images/events_icon.png"><div class="section-title">UPCOMING EVENTS</div>
                </div>
            </div>
        </div>
        
        <div class="home-right-section">
            <div class="member-of-month-container">
                <% if current_user and current_user.isOfficer %>
                    <div class="edit-motm" id="edit-container">
                        <img src="images/white_edit.png" id="top-edit">
                    </div>
                    <div id="edit-help">
                        Click here to toggle edit content. Editable text will turn red, uneditable text will turn black.
                        <div id="edit-help-carrot"></div>
                    </div>
                <%end%>
                <div class="section-header">
                    <img class="symbol" id="mom-symbol" src="/images/member_of_the_month_icon.png"><div class="section-title">MEMBER OF THE MONTH</div>
                </div>
                <div class="motm-avatar">
                    <%= image_tag(@info.avatar.url(:medium), :class => "motm-image") %>
                    <% if current_user and current_user.isOfficer %>
                        <%= form_for @info, :url => {:action => :update}, :html => { :multipart => true } do |form| %>
                            <%= form.file_field :avatar %>
                            <%= form.submit "upload" %>
                        <% end %>
                        <label for="info_avatar" id="edit-motm-photo">Edit Photo</label>
                    <%end%>
                </div>
                
                <div class="motm-name">
                    <%=@info.name %>
                </div>
                <div class="motm-comments">
                    <%= @info.comments %>
                </div>
            </div>
        </div>
        
    </div>
    
    <div class="home-footer-container">
        <div class="home-footer">
            <img class="copyright-symbol" src="images/copyright-symbol.png"><p>2016 Cal Red Cross Association</p>
        </div>
    </div>
</div>

<script>
    $(".home-carousel").slick({
        arrows: true,
        dots: true,
        infinite: true,
        speed: 500,
        fade: true,
        cssEase: 'linear'
    });
    
    $(".edit-bulletin").click(function() {
        console.log("EDIT bulletin");
        $(this).toggleClass("home-active");
        if (!$(this).hasClass("home-active")) {
            $.ajax({
                type : 'post',
                url : "/home/update",
                data : {"bulletin": $(".bulletin-description").text()},    
                dataType : 'json',
                async : false,
                context : document.body,
                success : function(response) {
                }
            });
        }
        var $div=$('.bulletin-description'), isEditable=$div.is('.editable');
        $div.prop('contenteditable',!isEditable).toggleClass('editable')
        $div.toggleClass("home-active");
    });
    $(".edit-motm").click(function() {
        console.log("EDIT Member Of The Month");
        $(this).toggleClass("home-active");
        if (!$(this).hasClass("home-active")) {
            $.ajax({
                type : 'post',
                url : "/home/update",
                data : {"motm_name": $(".motm-name").text(),
                        "motm_comments": $(".motm-comments").text()
                },    
                dataType : 'json',
                async : false,
                context : document.body,
                success : function(response) {
                }
            });
        }
        var $div=$('.motm-name'), isEditable=$div.is('.editable');
        $div.prop('contenteditable',!isEditable).toggleClass('editable')
        $div.toggleClass("home-active");
        
        var $div=$('.motm-comments'), isEditable=$div.is('.editable');
        $div.prop('contenteditable',!isEditable).toggleClass('editable')
        $div.toggleClass("home-active");
    });
    $('#info_avatar').change(function(e) {
                    var img = URL.createObjectURL(e.target.files[0]);
                    $(".motm-image").attr("src", img);
                    $(".edit_info").submit();
                });
</script>

