<!DOCTYPE html>
<html>
<head>
</head>

<body>
    <div class="profile-header">
        <a href="/"><img id="navbar-logo" src="/images/logo2.png"></a>
    </div>
    <div id="add-photo-container">
        <div class="screen"></div>
        <div id="add-photo-lightbox">
            <div id="close-photo-lightbox">x</div>
            <div id="add-photo-lightbox-content">
                <div id="add-photo-title">Add photos from your computer.</div>
                <label id="add-photos-label" for="add-photos">+ Select Photos</label>
                <input type="file" id="add-photos" name="add-photos" multiple>
<!--                 <%= form_for @gallery, html: {multipart: true } do |f| %>
                    <%= f.file_field :image %>
                    <%= f.submit %>
                <% end %> -->
            </div>
        </div>
    </div>
    <div class="gallery-container">
        <div id="gallery">
            <div class="photos-title">
                <h2 id="photo-title">Photos</h2>
                <div id="add-photos-button">+ Add Photos</div> 
            </div>
            <div class="photos-display">
                <% @galleries.each do |gallery| %>
                    <div class="photo-container">
                        <div class="save-photo">+</div>
                        <img class="photo" id=<%= gallery.id %> src=<%= gallery.image_url %>>
                        <div class="photo-date"> <%= gallery.created_at.strftime("%B %d, %Y")%> </div>
                    </div>
                <% end %>
            </div>
        </div>
    </div>
    
  

    
    <script>
        var closeLightbox = function() {
            $("#add-photo-container").slideUp( "medium", function() {
                $(this).hide(); 
              });
        }
        $("input[name=add-photos]").change(function() {
            for (var i = 0; i < $(this).get(0).files.length; ++i) {
                var file = $(this).get(0).files[i];
                var reader = new FileReader();
                
                reader.addEventListener("load", function () {
                    var image = encodeURIComponent(reader.result);
                    console.log("Image: " + image);
                    var formData = new FormData();
                    formData.append("image", image);
                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', '/galleries/add-photo', true);
                    xhr.onload = function () {
                      if (xhr.status === 200) {
                        // File(s) uploaded.
                        console.log("Success uploading photo!");
                      } else {
                        alert('An error occurred!');
                      }
                    };
                    xhr.send(formData);
                    //  $.ajax({
                    //     method : 'POST',
                    //     url : "/galleries/add-photo",
                    //     data : {formData: formData},    
                    //     // dataType : 'json',
                    //     // async : false,
                    //     context : document.body,
                    //     success : function(response) {
                    //         // var gallery = response;
                    //         // console.log("Gallery: " + gallery);
                            
                            
                    //     },
                    //     // contentType: false,
                    //     processData: false
                    // });
                  }, false);

                  if (file) {
                    reader.readAsBinaryString(file);
                  }
            }
            // console.log(images);
            closeLightbox();
        });
        $("#close-photo-lightbox").click(function() {
            closeLightbox();   
        });
        $("#add-photos-button").click(function() {
            $("#add-photo-container").show();
        });
        $(".save-photo").click(function() {
            var id = $(this).next().attr("id");
            console.log(id);
            $.ajax({
                        type : 'post',
                        url : "/galleries/add-favorite",
                        data : {"image": id},    
                        dataType : 'json',
                        async : false,
                        context : $(this),
                        success : function(response) {
                             $(this).text("âœ“");
                        }
                      });
        });
    </script>
</body>
</html>